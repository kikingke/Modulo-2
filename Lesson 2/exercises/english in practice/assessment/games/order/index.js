


let words_options = [
    {
        audio: [
            "I do not feel good. I have a headache.",
            'I feel terrible. I have a stomachache.',
            "I do not feel so good. I have a sore throat.",
            'I feel bad. I have a body ache. I think I have the flu.',
            'I feel tired and hot. I have a fever.',
            'I feel bad. I have an earache.'
        ],
        words: [
            { name: 'one', greeting: "I do not feel good. I have a headache.", letter: "I do not feel good. I have a headache." },
            { name: 'two', greeting: 'I feel terrible. I have a stomachache.', letter: 'I feel terrible. I have a stomachache.' },
            { name: 'three', greeting: `I do not feel so good. I have a sore throat.`, letter: `I do not feel so good. I have a sore throat.` },
            { name: 'four', greeting: 'I feel bad. I have a body ache. I think I have the flu.', letter: 'I feel bad. I have a body ache. I think I have the flu.' },
            { name: 'five', greeting: 'I feel tired and hot. I have a fever.', letter: 'I feel tired and hot. I have a fever.' },
            { name: 'six', greeting: 'I feel bad. I have an earache.', letter: 'I feel bad. I have an earache.' }
        ]
    },
    {
        audio: [
            'I feel terrible. I have a stomachache.',
            "I do not feel good. I have a headache.",
            "I don not feel so good. I have a sore throat.",
            'I feel tired and hot. I have a fever.',
            'I feel bad. I have a body ache. I think I have the flu.',
            'I feel bad. I have an earache.'
        ],
        words: [
            { name: 'one', greeting: "I feel terrible. I have a stomachache.", letter: "I feel terrible. I have a stomachache." },
            { name: 'two', greeting: 'I do not feel good. I have a headache.', letter: 'I do not feel good. I have a headache.' },
            { name: 'three', greeting: `I don't feel so good. I have a sore throat.`, letter: `I don't feel so good. I have a sore throat.` },
            { name: 'four', greeting: 'I feel tired and hot. I have a fever.', letter: 'I feel tired and hot. I have a fever.' },
            { name: 'five', greeting: 'I feel bad. I have a body ache. I think I have the flu.', letter: 'I feel bad. I have a body ache. I think I have the flu.' },
            { name: 'six', greeting: 'I feel bad. I have an earache.', letter: 'I feel bad. I have an earache.' }
        ]
    },
    {
        audio: [
            "I do not feel so good. I have a sore throat.",
            "I do not feel good. I have a headache.",
            'I feel bad. I have an earache.',
            'I feel tired and hot. I have a fever.',
            'I feel terrible. I have a stomachache.',
            'I feel bad. I have a body ache. I think I have the flu.',
        ],
        words: [
            { name: 'one', greeting: "I do not feel so good. I have a sore throat.", letter: "I do not feel so good. I have a sore throat." },
            { name: 'two', greeting: `I do not feel good. I have a headache.`, letter: `I do not feel good. I have a headache.` },
            { name: 'three', greeting: 'I feel bad. I have an earache.', letter: 'I feel bad. I have an earache.' },
            { name: 'four', greeting: 'I feel tired and hot. I have a fever.', letter: 'I feel tired and hot. I have a fever.' },
            { name: 'five', greeting: 'I feel terrible. I have a stomachache.', letter: 'I feel terrible. I have a stomachache.' },
            { name: 'six', greeting: 'I feel bad. I have a body ache. I think I have the flu.', letter: 'I feel bad. I have a body ache. I think I have the flu.' }
        ]
    },
    {
        audio: [
            "I do not feel good. I have a headache.",
            'I feel terrible. I have a stomachache.',
            "I don not feel so good. I have a sore throat.",
            'I feel bad. I have a body ache. I think I have the flu.',
            'I feel tired and hot. I have a fever.',
            'I feel bad. I have an earache.'
        ],
        words: [
            { name: 'one', greeting: "I do not feel good. I have a headache.", letter: "I do not feel good. I have a headache." },
            { name: 'two', greeting: 'I feel terrible. I have a stomachache.', letter: 'I feel terrible. I have a stomachache.' },
            { name: 'three', greeting: `I don't feel so good. I have a sore throat.`, letter: `I don't feel so good. I have a sore throat.` },
            { name: 'four', greeting: 'I feel bad. I have a body ache. I think I have the flu.', letter: 'I feel bad. I have a body ache. I think I have the flu.' },
            { name: 'five', greeting: 'I feel tired and hot. I have a fever.', letter: 'I feel tired and hot. I have a fever.' },
            { name: 'six', greeting: 'I feel bad. I have an earache.', letter: 'I feel bad. I have an earache.' }
        ]
    },
    {
        audio: [
            "I do not feel good. I have a headache.",
            'I feel terrible. I have a stomachache.',
            "I don not feel so good. I have a sore throat.",
            'I feel bad. I have a body ache. I think I have the flu.',
            'I feel tired and hot. I have a fever.',
            'I feel bad. I have an earache.'
        ],
        words: [
            { name: 'one', greeting: "I do not feel good. I have a headache.", letter: "I do not feel good. I have a headache." },
            { name: 'two', greeting: 'I feel terrible. I have a stomachache.', letter: 'I feel terrible. I have a stomachache.' },
            { name: 'three', greeting: `I don't feel so good. I have a sore throat.`, letter: `I don't feel so good. I have a sore throat.` },
            { name: 'four', greeting: 'I feel bad. I have a body ache. I think I have the flu.', letter: 'I feel bad. I have a body ache. I think I have the flu.' },
            { name: 'five', greeting: 'I feel tired and hot. I have a fever.', letter: 'I feel tired and hot. I have a fever.' },
            { name: 'six', greeting: 'I feel bad. I have an earache.', letter: 'I feel bad. I have an earache.' }
        ]
    },
    {
        audio: [
            'I feel bad. I have an earache.',
            'I feel bad. I have a body ache. I think I have the flu.',
            "I don not feel so good. I have a sore throat.",
            "I do not feel good. I have a headache.",
            'I feel tired and hot. I have a fever.',
            'I feel terrible. I have a stomachache.',
        ],
        words: [
            { name: 'one', greeting: "I feel bad. I have an earache.", letter: "I do not feel good. I have a headache." },
            { name: 'two', greeting: 'I feel bad. I have a body ache. I think I have the flu.', letter: 'I feel bad. I have a body ache. I think I have the flu.' },
            { name: 'three', greeting: `I don't feel so good. I have a sore throat.`, letter: `I don't feel so good. I have a sore throat.` },
            { name: 'four', greeting: ' I do not feel good. I have a headache.', letter: ' I do not feel good. I have a headache.' },
            { name: 'five', greeting: 'I feel tired and hot. I have a fever.', letter: 'I feel tired and hot. I have a fever.' },
            { name: 'six', greeting: 'I feel terrible. I have a stomachache.', letter: 'I feel terrible. I have a stomachache.' }
        ]
    }
]

countAllWords = () => {
    let count = 0
    words_options.forEach(item => count += item.words.length)
    return count
}

let currentCard = 0
let accerts = [];
let intents = 0;
let limitIntents = 6

window.onload = () => {
    showSectionGame();
}

function showSectionGame() {
    changeStatusButtons()
    let card = words_options[currentCard]
    document.getElementById("contenedor-drag").innerHTML = `
        <p class="subtitle-activity text-start">Listen and order the sentences.</p>
        <div class="bg-white border-radius mb-4 cross-center cursor-pointer p-3" style="height: 4rem;" 
            onclick="responsiveVoice.speak('${card.audio}')">
            <img src="./assets/img/sound-icon.svg" class="h-100 " alt="">
        </div>`


    let correctPosition = 0

    getRandomArray(card.words).forEach((word, key) => {
        let optionCorrect = card.words[correctPosition]
        correctPosition++

        let identify = `card-${currentCard}-answer-${key}`

        document.getElementById("contenedor-drag").innerHTML += `
            <div class="h-100 grid">
                <div id="${word.name}" class="bg-white border-radius py-1 text-center cursor-pointer w-100 draggable cross-center" data-partbody="${identify}">
                    <h3>${word.letter}</h3>
                </div>
                <div class="bg-transparent my-4 w-100 droppable border-radius" id="${optionCorrect.name}-drop">
                    
                </div>
            </div>` ;
    })

    addDraggableElements(card.words);
}

function addDraggableElements(words) {
    words.forEach(drag => {
        let overlapThreshold = "80%";

        let elementDrag = document.getElementById(drag.name)
        let elementDrop = document.getElementById(`${drag.name}-drop`)

        Draggable.create(elementDrag, {
            bounds: "div",
            type: "x,y",
            cursor: "pointer",
            activeCursor: "grab", activeCursor: "grabbing",
            onClick: function (e) {
                responsiveVoice.speak(drag.greeting);
            },
            onDragStart: function (e) {
                responsiveVoice.speak(drag.greeting);
            },
            onPress: function (e) {
                if (limitIntents == 0) this.kill(), soundIncorrectAnswer(), alertTryAgain();
            },
            onDrag: function (e) {
                if (this.hitTest(elementDrop, overlapThreshold)) $(this.target).attr("id", "correct");
                else $(this.target).removeAttr("id", "correct");
            },
            onDragEnd: function (e) {
                intents++

                // valida si el elemento tiene el id correct si no lo tiene lo devuelve a su posicion inicial 
                if (!$(this.target).attr("id")) {
                    // move to original pos
                    TweenLite.to(this.target, 0.2, {
                        x: 0,
                        y: 0
                    })
                    limitIntents--;
                    soundIncorrectAnswer();
                } else {
                    soundCorrectAnswer();
                    if (!accerts.includes($(this.target).data('partbody'))) {
                        accerts.push($(this.target).data('partbody'));
                        this.kill();
                    }
                }

                if (accerts.length == countAllWords()) alertExcellentWithImage();

                let score = (accerts.length * 100) / intents
                console.log(score)
                setScoreStorage(module = 'M1', lesson = 'L3', { name: 'order the letters', score: score, type: 'assessment' })
            }
        });
    });
}


function soundGameSuccess() {
    const music = new Audio('./assets/audios/game-success.mp3');
    music.play();
}

function soundCorrectAnswer() {
    const music = new Audio('./assets/audios/correct-answer.mp3');
    music.play();
}

function soundIncorrectAnswer() {
    const music = new Audio('./assets/audios/incorrect-answer.mp3');
    music.play();
}

function soundAddStar() {
    const music = new Audio('./assets/audios/points.mp3');
    music.play();
}


function slideNext() {
    currentCard <= words_options.length && currentCard++
    showSectionGame()
}
function slidePrev() {
    currentCard >= 0 && currentCard--
    showSectionGame()
}

function changeStatusButtons() {
    if (currentCard <= 0) {
        document.querySelector("#img-prev").src = "./assets/img/button-back-gray.svg";
        document.querySelector("#btn-back").disabled = true;
    } else {
        document.querySelector("#img-prev").src = "./assets/img/button-back.svg";
        document.querySelector("#btn-back").disabled = false;
    }

    if (currentCard == words_options.length - 1) {
        document.querySelector("#img-next").src = "./assets/img/button-next-gray.svg";
        document.querySelector("#btn-next").disabled = true;
    } else {
        document.querySelector("#img-next").src = "./assets/img/button-next.svg";
        document.querySelector("#btn-next").disabled = false;
    }
}
